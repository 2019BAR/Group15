---
title: AS13Cï¼šé¡åˆ¥æ¨¡å‹ã€é æ¸¬æ©Ÿç‡èˆ‡å•†æ¥­æ±ºç­– 
subtitle: é æ¸¬èˆ‡æ±ºç­–
author: "ç¬¬ 15 çµ„"
date: "`r Sys.time()`"
output: 
  html_document:
    highlight: pygments
    theme: flatly
    css: style.css
---

çµ„å“¡ï¼š`B044030015 è¨±æ•ˆè»’`  `B046060036 ç‹æ–‡å¼˜`  `B054012011 é»ƒå† ç¶¾`  `B046060027 å§šè© é¦¨`  `B046060035 å¼µæ–‡ç‘œ`  `M074020024 æ¥Šé•·èˆœ`

```{r results='hide', message=FALSE, warning=FALSE, echo=F}
# Formating Codes.  Do not change the codes in this chunk !!
rm(list=ls(all=T))
knitr::opts_chunk$set(comment = NA)
knitr::opts_knit$set(global.par = TRUE)
par(cex=0.8)
options(scipen=20, digits=5, width=80)
if(!require(pacman)) install.packages("pacman")
```
<hr>

```{r results='hide', message=FALSE, warning=FALSE}
pacman::p_load(caTools, ggplot2, dplyr)
D = read.csv("data/quality.csv")  # Read in dataset
set.seed(88)
split = sample.split(D$PoorCare, SplitRatio = 0.75)  # split vector
TR = subset(D, split == TRUE)
TS = subset(D, split == FALSE)
glm1 = glm(PoorCare ~ OfficeVisits + Narcotics, TR, family=binomial)
summary(glm1)
```
<br><hr>

### ã€Aã€‘å¾é æ¸¬åˆ°æ±ºç­–

![Fig 13.3 - å¾é æ¸¬åˆ°æ±ºç­–](Fig13.3.JPG)

<br><hr>

### ã€Bã€‘é æ¸¬æ©Ÿç‡åˆ†ä½ˆ (DPP)
å› ç‚ºé€™å€‹è³‡æ–™é›†å¾ˆå°ï¼Œæˆ‘å€‘ä½¿ç”¨å…¨éƒ¨çš„è³‡æ–™ä¾†åšæ¨¡æ“¬ (é€šå¸¸æˆ‘å€‘æ˜¯ä½¿ç”¨æ¸¬è©¦è³‡æ–™é›†)
```{r fig.height=3.2, fig.width=7}
pred = predict(glm1, D, type="response")
y = D$PoorCare
data.frame(pred, y) %>% 
  ggplot(aes(x=pred, fill=factor(y))) + 
  geom_histogram(bins=20, col='white', position="stack", alpha=0.5) +
  ggtitle("Distribution of Predicted Probability (DPP,FULL)") +
  xlab("predicted probability")
```
<br><hr>

### ã€Cã€‘è©¦ç®—æœŸæœ›å ±é…¬

**å ±é…¬çŸ©é™£ Payoff Matrix**

+ TN: NoAction, GoodCare; æ²’äº‹   
+ FN: NoAction, PoorCare; é¢¨éšªæˆæœ¬å¾ˆé«˜ 
+ FP: Action, GoodCare;   é é˜²æˆæœ¬
+ TP: Action, PoorCare;   é é˜²æˆæœ¬ + é™ä½å¾Œçš„é¢¨éšªæˆæœ¬

```{r}
payoff = matrix(c(0,-100,-10,-50),2,2)
payoff
```

**æœŸæœ›å ±é…¬ Expected Payoff**
```{r fig.height=3.2, fig.width=7}
cutoff = seq(0, 1, 0.01)
result = sapply(cutoff, function(p) sum(
  table(factor(y==1, c(F,T)), factor(pred>p, c(F,T))) # confusion matrix
  * payoff ))
i = which.max(result)
par(cex=0.7, mar=c(4,4,3,1))
plot(cutoff, result, type='l', col='cyan', lwd=2, main=sprintf(
  "Optomal Expected Result: $%d @ %.2f",result[i],cutoff[i]))
abline(v=seq(0,1,0.1),h=seq(-6000,0,100),col='lightgray',lty=3)
points(cutoff[i], result[i], pch=20, col='red', cex=2)
```
<br><hr>

### ã€Dã€‘ç­–ç•¥æ¨¡æ“¬
<p class="qiz">
<span style="font-size:24px">`r "\U1F5FF"` ç·´ç¿’ï¼š </span><br>
åŸ·è¡Œ`Sim13.R`ï¼Œå…ˆä¾é è¨­çš„å ±é…¬çŸ©é™£å›ç­”ä¸‹åˆ—å•é¡Œï¼š<br>
&emsp; ã€Aã€‘ æœ€ä½³è‡¨ç•Œæ©Ÿç‡æ˜¯ï¼Ÿ å®ƒæ‰€å°æ‡‰çš„æœŸæœ›å ±é…¬æ˜¯å¤šå°‘ï¼Ÿ<br>
&emsp;  Ans: è‡¨ç•Œæ©Ÿç‡ = 0.16 ï¼ŒæœŸæœ›å ±é…¬ = -2360ã€‚<br>

&emsp; ã€Bã€‘ ä»€éº¼éƒ½ä¸åšæ™‚ï¼Œè‡¨ç•Œæ©Ÿç‡å’ŒæœŸæœ›å ±é…¬å„æ˜¯å¤šå°‘ï¼Ÿ<br>
&emsp;  Ansï¼šè‡¨ç•Œæ©Ÿç‡ = 1 ï¼Œ æœŸæœ›å ±é…¬ = -3300ã€‚<br>

&emsp; ã€Cã€‘ æ¯ä½ä¿æˆ¶éƒ½åšæ™‚ï¼Œè‡¨ç•Œæ©Ÿç‡å’ŒæœŸæœ›å ±é…¬å„æ˜¯å¤šå°‘ï¼Ÿ<br>
&emsp;  Ansï¼šè‡¨ç•Œæ©Ÿç‡ = 0 ï¼Œ æœŸæœ›å ±é…¬ = -2630ã€‚<br>

&emsp; ã€Dã€‘ ä»¥ä¸Šå“ªä¸€ç¨®åšæ³•çš„æœŸæœ›å ±é…¬æ¯”è¼ƒé«˜ï¼Ÿ<br>
&emsp;  Ans: è‹¥åªè€ƒæ…®Bã€Cå…¨åšèˆ‡å…¨ä¸åšçš„æƒ…æ³ä¸‹ï¼Œå…¨éƒ½åšçš„æœŸæœ›å ±é…¬æ¯”è¼ƒé«˜ï¼Œè‹¥è€ƒæ…®å…¥ä¸€éƒ¨ä»½åšä¸€éƒ¨ä»½ä¸åšçš„æƒ…æ³ï¼Œåšä¸€éƒ¨ä»½Açš„æœŸæœ›å ±é…¬æœ€å¤§ã€‚<br>

&emsp; ã€Eã€‘ åœ¨æ‰€æœ‰çš„å•†å‹™æƒ…å¢ƒéƒ½æ˜¯é€™ç¨®ç‹€æ³å—ï¼Ÿ<br>
&emsp;  Ans: ä¸ä¸€å®šï¼Œå› ç‚ºä¸åŒæƒ…å¢ƒæœƒæœ‰ä¸åŒçš„å ±é…¬çŸ©é™£ï¼Œä»£å…¥ä¹‹å¾Œï¼Œæœ€ä½³è‡¨ç•Œæ©Ÿç‡è·ŸæœŸæœ›å ±é…¬éƒ½æœƒéš¨è‘—æ”¹è®Šã€‚<br>

è—‰ç”±èª¿æ•´å ±é…¬çŸ©é™£ï¼š<br>
&emsp; ã€Fã€‘ æ¨¡æ“¬å‡ºã€Œå…¨ä¸åšã€æ¯”ã€Œå…¨åšã€é‚„è¦å¥½çš„ç‹€æ³<br>
```{r}
matrix(c(-35,-50,-70,-100),2,2)
```

&emsp; ã€Gã€‘ ä¸¦èˆ‰å‡ºä¸€å€‹æœƒç™¼ç”Ÿé€™ç¨®ç‹€æ³çš„å•†å‹™æƒ…å¢ƒ<br>
&emsp;  Ans:<br>
&emsp;  + TN: æ²’è©æ¬º; æ²’å‡çµå¸³æˆ¶<br>
&emsp;  + FN: å¯¦éš›æœ‰è©æ¬ºå«Œç–‘; æ²’å‡çµå¸³æˆ¶<br>
&emsp;  + FP: æ²’è©æ¬º; å‡çµå¸³æˆ¶<br>
&emsp;  + TP: æœ‰è©æ¬ºå«Œç–‘; å‡çµå¸³æˆ¶<br>
&emsp;  ç”±æ–¼æœƒè©æ¬ºçš„å®¢æˆ¶ç‚ºå°‘æ•¸å€‹æ¡ˆï¼Œå¦‚æœæŠŠæ‰€æœ‰å®¢æˆ¶å¸³æˆ¶å…¨å‡çµï¼Œä½ é‚„æ˜¯åˆ¥é–‹éŠ€è¡Œäº†ğŸ‘€<br>

æœ‰äº”ç¨®æˆæœ¬åˆ†åˆ¥ç‚º`$5, $10, $15, $20, $30`çš„ä»‹å…¥æ–¹æ³•ï¼Œå®ƒå€‘åˆ†åˆ¥å¯ä»¥å°‡é¢¨éšªæˆæœ¬å¾`$100`é™ä½åˆ°`$70, $60, $50, $40, $25` ...<br>
&emsp; ã€Hã€‘ å®ƒå€‘çš„æœ€ä½³æœŸæœ›å ±é…¬åˆ†åˆ¥æ˜¯å¤šå°‘ï¼Ÿ<br>
&emsp;  Ansï¼š<br>
&emsp;  FP = -5ï¼ŒTP = -75ï¼› è‡¨ç•Œæ©Ÿç‡ = 0.16 ï¼Œ æœŸæœ›å ±é…¬ = -2830ã€‚<br>
&emsp;  FP = -10ï¼ŒTP = -70ï¼›è‡¨ç•Œæ©Ÿç‡ = 0.36 ï¼Œ æœŸæœ›å ±é…¬ = -2830ã€‚<br>
&emsp;  FP = -15ï¼ŒTP = -65ï¼›è‡¨ç•Œæ©Ÿç‡ = 0.36 ï¼Œ æœŸæœ›å ±é…¬ = -2775ã€‚<br>
&emsp;  FP = -20ï¼ŒTP = -60ï¼›è‡¨ç•Œæ©Ÿç‡ = 0.36 ï¼Œ æœŸæœ›å ±é…¬ = -2720ã€‚<br>
&emsp;  FP = -30ï¼ŒTP = -55ï¼›è‡¨ç•Œæ©Ÿç‡ = 0.36 ï¼Œ æœŸæœ›å ±é…¬ = -2700ã€‚<br>

&emsp; ã€Iã€‘ å“ªä¸€ç¨®ä»‹å…¥æ–¹æ³•çš„æœ€ä½³æœŸæœ›å ±é…¬æ˜¯æœ€å¤§çš„å‘¢ï¼Ÿ<br>
&emsp;  Ans:`$30`çš„ä»‹å…¥æ–¹æ³•ï¼Œæœ€ä½³æœŸæœ›å ±é…¬æœ€å¤§ã€‚<br>

</p class="qiz">

**ä½¿ç”¨`manipulate`å¥—ä»¶åšç­–ç•¥æ¨¡æ“¬**
```{r eval=F}
library(manipulate)
manipulate({
  payoff = matrix(c(TN,FN,FP,TP),2,2)
  cutoff = seq(0, 1, 0.01)
  result = sapply(cutoff, function(p) sum(
    table(factor(y==1, c(F,T)), factor(pred>p, c(F,T))) # confusion matrix
    * payoff ))
  i = which.max(result)
  par(cex=0.7)
  plot(cutoff, result, type='l', col='cyan', lwd=2, main=sprintf(
    "Optomal Expected Result: $%d @ %.2f",result[i],cutoff[i]))
  abline(v=seq(0,1,0.1),h=seq(-10000,0,100),col='lightgray',lty=3)
  points(cutoff[i], result[i], pch=20, col='red', cex=2)
  },
  TN = slider(-100,0,   0,step=5),
  FN = slider(-100,0,-100,step=5),
  FP = slider(-100,0, -10,step=5),
  TP = slider(-100,0, -50,step=5)
  ) 
```



<br><br><br><hr>
